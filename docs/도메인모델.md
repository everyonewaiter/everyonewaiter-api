# 모두의 웨이터 도메인 모델

## 목차

- [공용](#공용)
- [헬스 체크](#헬스-체크)
- [서비스 도입 문의](#서비스-도입-문의)
- [알림](#알림)
- [SSE](#SSE)
- [인증](#인증)
- [계정](#계정)
- [기기](#기기)

---

## 공용

### BusinessException

_Exception_

#### 속성

- `errorCode`: 커스텀 에러 코드

### AuthenticationException

_BusinessException_

### AccessDeniedException

_BusinessException_

### 에러 코드

_Enum_

#### 상수

[ErrorCode.java](../src/main/java/com/everyonewaiter/domain/shared/ErrorCode.java)

#### 속성

- `status`: Http 상태 코드
- `message`: 클라이언트 전송용 메시지

### 페이지네이션(Pagination)

_Value Object_

#### 속성

- `page`: 페이지 번호
- `size`: 조회할 데이터 수
- `pageSkipSize`: FastForward 페이지 이동 사이즈 (default 5)

#### 행위

- `countLimit()`: FastForward 페이지 계산을 위해 `count` 조회해야하는 데이터 수를 반환한다.
- `limit()`: 조회할 데이터 수를 반환한다.
- `offset()`: `page`와 `size`를 가지고 스킵해야하는 `offset`을 계산하여 반환한다.

### 페이징(Paging)

_Value Object_

#### 속성

- `content`: 현재 페이지 조회 데이터
- `page`: 현재 페이지 번호
- `size`: 조회 데이터 수
- `pageSkipSize`: FastForward 페이지 이동 사이즈
- `count`: FastForward 페이지 `count` 조회 결과 (실 데이터 수)
- `hasNext`: 다음 페이지 여부
- `hasPrevious`: 이전 페이지 여부
- `isFirst`: 첫번째 페이지 여부
- `isLast`: 마지막 페이지 여부
- `fastForwardPage`: FastForward 페이지 번호
- `fastBackwardPage`: FastBackward 페이지 번호

#### 행위

- `map()`: 현재 페이지 조회 데이터의 타입을 변경한다.
- `getContent()`: 현재 페이지 조회 데이터를 변경 불가능한 컬렉션으로 래핑하여 반환한다.

### 이메일(Email)

_Value Object_

#### 속성

- `address`: 이메일 주소

### 사업자 등록 번호(BusinessLicense)

_Value Object_

#### 속성

- `value`: 사업자 등록 번호

### 휴대폰 번호(PhoneNumber)

_Value Object_

#### 속성

- `value`: 휴대폰 번호

### 위치(Position)

_Value Object_

#### 속성

- `value`: 위치 정수값

#### 행위

- `static next()`: 다음 위치값을 가진 위치를 생성한다.
- `static copy()`: 동일한 위치값을 가진 위치를 생성한다.
- `static isMoved()`: 위치값이 이동했는지 여부를 반환한다.
- `move()`: 위치를 이동한다.

### 위치 이동(PositionMove)

_Enum_

#### 상수

- `PREV`: 이전
- `NEXT`: 다음

#### 속성

- `moveCount`: 이동해야 할 위치값

#### 행위

- `move()`: 이동 후 위치값을 반환한다.

---

## 헬스 체크

### 서버 정보(ServerInfo)

_Value Object_

#### 속성

- `version`: 서버 빌드 버전
- `group`: 서버 그룹
- `artifact`: 서버 아티팩트

### 앱 버전 정보(ApkVersion)

_Entity_

_Aggregate Root_

#### 속성

- `majorVersion`: 앱 메이저 버전
- `minorVersion`: 앱 마이너 버전
- `patchVersion`: 앱 패치 버전
- `downloadUrl`: 앱 다운로드 링크

#### 행위

- `static create()`: 앱 버전 정보를 생성한다.

### ApkVersionNotFoundException

_BusinessException_

---

## 서비스 도입 문의

### 서비스 도입 문의(Contact)

_Entity_

_Aggregate Root_

#### 속성

- `storeName`: 서비스를 도입할 매장 이름
- `phoneNumber`: 사장님 휴대폰 번호
- `license`: 매장 사업자 등록 번호
- `state`: `ContactState` 서비스 도입 문의 진행 상태

#### 행위

- `static create()`: 서비스 도입 문의를 생성한다.
- `processing()`: 서비스 도입 문의 진행 상태를 처리중 상태로 변경한다.
- `complete()`: 서비스 도입 문의 진행 상태를 처리 완료 상태로 변경한다.

### 서비스 도입 문의 진행 상태(ContactState)

_Enum_

#### 상수

- `PENDING`: 접수 대기
- `PROCESSING`: 처리중
- `COMPLETE`: 처리 완료

### AlreadyExistsUncompletedContactException

_BusinessException_

### ContactNotFoundException

_BusinessException_

---

## 알림

### 이메일—SimpleEmail

_Value Object_

#### 속성

- `from`: 발신 이메일
- `to`: 수신 이메일
- `subject`: 이메일 제목
- `content`: 이메일 본문

### 이메일—TemplateEmail

_Value Object_

#### 속성

- `from`: 발신 이메일
- `to`: 수신 이메일
- `subject`: 이메일 제목
- `template`: `EmailTemplate` 이메일 템플릿
- `templateVariables`: 이메일 템플릿 변수 목록

#### 행위

- `addTemplateVariable()`: 이메일 템플릿 변수를 추가한다.
- `toSimpleEmail()`: `SimpleEmail` 도메인 객체로 변환한다.

### 이메일—EmailTemplate

_Enum_

#### 상수

- `EMAIL_AUTHENTICATION`: 이메일 인증
- `STORE_REGISTRATION_APPROVE`: 매장 등록 승인
- `STORE_REGISTRATION_REJECT`: 매장 등록 반려

#### 속성

- `templateName`: 템플릿 파일명
- `variableCount`: 템플릿 변수 개수

#### 행위

- `createContent()`: 템플릿을 사용한 이메일 본문을 생성한다.

### 알림톡—AlimTalkMessage

_Value Object_

#### 속성

- `templateCode`: 알림톡 템플릿 코드
- `to`: 알림톡 수신 휴대폰 번호
- `content`: 알림톡 본문
- `useSmsFailover`: 알림톡 발송 실패 시 SMS 사용 여부
- `buttons`: 알림톡 버튼 목록

#### 행위

- `addButton()`: 알림톡 버튼을 추가한다.

### 알림톡—AlimTalkTemplate

_Enum_

#### 상수

- `AUTHENTICATION_CODE`: 인증 번호 안내
- `WAITING_REGISTRATION`: 웨이팅 등록
- `WAITING_CUSTOMER_CALL`: 웨이팅 손님 호출
- `WAITING_CUSTOMER_CANCEL`: 웨이팅 손님 취소
- `WAITING_STORE_CANCEL`: 웨이팅 매장 취소

#### 속성

- `templateCode`: 네이버 클라욷 플랫폼에 등록된 템플릿 코드
- `templateContent`: 네이버 클라욷 플랫폼에 등록된 템플릿 본문 (정확히 일치해야함)

#### 행위

- `createContent()`: 템플릿을 사용한 알림톡 본문을 반환한다.

### 알림톡—AlimTalkButton

_Marker Interface_

### 알림톡—AlimTalkWeblinkButton

_Value Object_

_AlimTalkButton_

#### 속성

- `type`: 알림톡 버튼 타입 (WL)
- `name`: 알림톡 버튼 이름
- `linkMobile`: 모바일 웹 링크
- `linkPc`: PC 웹 링크

### 알림톡—AlimTalkButtonTemplate

_Interface_

#### 행위

- `createButton()`: 알림톡 버튼을 생성한다.

### 알림톡—AlimTalkWeblinkButtonTemplate

_Enum_

_AlimTalkButtonTemplate_

#### 상수

- `WAITING_CANCEL`: 웨이팅 취소 버튼
- `CHECK_MY_TURN`: 내 순서 확인하기 버튼
- `MENU_PREVIEW`: 메뉴 미리보기 버튼

#### 속성

- `name`: 버튼 이름
- `link`: 버튼 클릭 시 이동할 웹(앱)링크

#### 행위

- `createButton()`: 알림톡 버튼을 생성한다.

### 디스코드—DiscordEmbeds

_Value Object_

#### 속성

- `embeds`: `DiscordEmbed` 목록

### 디스코드—DiscordEmbed

_Value Object_

#### 속성

- `title`: 디스코드 임베드 제목
- `description`: 디스코드 임베드 설명
- `color`: `DiscordColor` 디스코드 임베드 색상
- `fields`: 디스코드 임베드 필드 목록

#### 행위

- `addField()`: 디스코드 임베드 필드를 추가한다.

### 디스코드—DiscordField

_Value Object_

#### 속성

- `name`: 필드 이름
- `value`: 필드값

### 디스코드—DiscordColor

_Enum_

#### 상수

- `GREEN`: 초록색
- `BLUE`: 파란색
- `DARK_BLUE`: 진한 파란색
- `RED`: 빨간색

#### 속성

- `value`: 10진수 색상값

---

## SSE

### SseEvent

_Value Object_

#### 속성

- `storeId`: SSE를 발행할 매장 ID
- `category`: `SseCategory` SSE 발행 주체 카테고리 (도메인 목록)
- `action`: `ServerAction` 서버에서 어떤 작업을 했는지에 대한 정보 (CRUD)
- `hasData`: SSE 응답 데이터 여부
- `data`: SSE 응답 데이터

### SseCategory

_Enum_

#### 상수

- `DEVICE`: 기기 도메인
- `STORE`: 매장 도메인
- `CATEGORY`: 카테고리 도메인
- `MENU`: 메뉴 도메인
- `WAITING`: 웨이팅 도메인
- `ORDER`: 주문 도메인
- `STAFF_CALL`: 직원 호출 도메인
- `RECEIPT`: 레시피 도메인
- `POS`: POS 도메인

### ServerAction

_Enum_

#### 상수

- `GET`: 조회
- `CREATE`: 생성
- `UPDATE`: 수정
- `DELETE`: 삭제

### SseKeyType

_Enum_

#### 상수

- `EMITTER`: SSE Emitter
- `EVENT`: SSE Event

#### 행위

- `createKey()`: SSE 이미터 또는 이벤트를 저장할 때 사용할 키를 생성한다.
- `createScanKey()`: SSE 이미터 또는 이벤트를 조회할 때 사용할 스캔용 키를 생성한다.

---

## 인증

### AuthenticationAccount

_Annotation_

Spring AOP를 사용하여 웹 계층에서 로그인 여부, 권한 검증에 사용된다.

### AuthenticationDevice

_Annotation_

Spring AOP를 사용하여 웹 계층에서 기기 인증, 기기 사용 용도 검증에 사용된다.

### Auth

_Interface_

#### 행위

- `key()`: 인증 번호, 인증 성공, 인증 시도 횟수를 저장할 키값을 반환한다.
- `value()`: 인증 번호, 인증 성공, 인증 시도 횟수를 저장할 값을 반환한다.
- `expiration()`: 인증 번호, 인증 성공, 인증 시도 횟수의 유효 기간을 반환한다.

### AuthAttempt

_Auth_

#### 속성

- `purpose`: `AuthPurpose` 인증 목적
- `phoneNumber`: 인증할 휴대폰 번호
- `expiration`: 인증 시도 횟수 유효 기간(24시간)

#### 행위

- `isExceed()`: 인증 시도 횟수 초과 여부를 반환한다.
- `key()`: 인증 시도 횟수를 저장할 때 사용하는 키값을 반환한다.
- `value()`: 사용 안함

### AuthCode

_Auth_

#### 속성

- `phoneNumber`: 인증 번호를 전송할 휴대폰 번호
- `code`: 인증 번호
- `expiration`: 인증 번호 유효 기간(5분)

#### 행위

- `verify()`: 인증 번호를 검증한다.
- `key()`: 인증 번호를 저장할 때 사용하는 키값을 반환한다.
- `value()`: 인증 번호를 반환한다.

### AuthSuccess

_Auth_

#### 속성

- `purpose`: `AuthPurpose` 인증 목적
- `phoneNumber`: 인증 휴대폰 번호
- `expiration`: 인증 성공 유효 기간

#### 행위

- `key()`: 인증 성공을 저장할 때 사용하는 키값을 반환한다.
- `value()`: 사용 안함

### AuthPurpose

_Enum_

#### 상수

- `SIGN_UP`: 회원가입
- `CREATE_DEVICE`: 기기 생성

#### 속성

- `maxAttempt`: 최대 인증 시도 가능 횟수
- `expiration`: 인증 목적별 인증 성공 유효 기간

#### 행위

- `isExceed()`: 인증 시도 횟수 초과 여부를 반환한다.
- `getLowerCaseName()`: 상수명을 소문자로 변환하여 반환한다.

### RefreshToken

_Entity_

_Aggregate Root_

#### 속성

- `accountId`: 리프레시 토큰 소유 계정 ID
- `currentTokenId`: 현재 활성 리프레시 토큰 ID

#### 행위

- `static create()`: 리프레시 토큰을 생성한다.
- `renew()`: 리프레시 토큰을 갱신한다.

### SignInToken

_Value Object_

#### 속성

- `accessToken`: 로그인 또는 토큰 갱신 시 발급한 액세스 토큰
- `refreshToken`: 로그인 또는 토큰 갱신 시 발급한 리프레시 토큰

### JwtPayload

_Value Object_

#### 속성

- `id`: JWT의 ID
- `subject`: JWT의 SUBJECT

### AlreadyVerifiedPhoneException

_BusinessException_

### ExceedMaximumVerificationException

_BusinessException_

### ExpiredVerificationCodeException

_BusinessException_

### ExpiredVerificationEmailException

_BusinessException_

### ExpiredVerificationPhoneException

_BusinessException_

### UnmatchedVerificationCodeException

_BusinessException_

---

## 계정

### Account

_Entity_

_Aggregate Root_

#### 속성

- `email`: `Email` 이메일 주소
- `password`: 암호화 된 비밀번호
- `phoneNumber`: `PhoneNumber` 휴대폰 번호
- `state`: `AccountState` 계정 상태
- `permission`: `AccountPermission` 계정 권한
- `lastSignIn`: 마지막 로그인 시간

#### 행위

- `static create()`: 계정을 생성한다.
- `isInactive()`: 계정이 비활성 상태인지 여부를 반환한다.
- `isActive()`: 계정이 활성 상태인지 여부를 반환한다.
- `hasPermission()`: 계정이 권한을 가지고 있는지 여부를 반환한다. (계층형)
- `activate()`: 비활성 상태의 계정을 활성 상태로 변경한다.
- `authorize()`: 활성 상태의 계정에 권한을 부여한다.
- `signIn()`: 계정을 로그인 처리한다.
- `update()`: 관리자 계정으로 사용자 계정 정보를 업데이트한다.

### AccountState

_Enum_

#### 상수

- `INACTIVE`: 비활성 - 이메일 인증이 완료되지 않은 상태
- `ACTIVE`: 활성 - 이메일 인증이 완료된 상태
- `DELETE`: 탈퇴 - 계정이 삭제된 상태

### AccountPermission

_Enum_

#### 상수

- `USER`: 사용자 권한 - 매장 등록 신청 가능
- `OWNER`: 사장님 권한 - 매장 등록이 완료되어 모든 기능을 사용 가능
- `ADMIN`: 관리자 권한 - 모두의 웨이터 관리자

### PasswordEncoder

_Interface_

#### 행위

- `encode()`: 평문 비밀번호를 암호화한다.
- `matches()`: 평문 비밀번호와 암호화 비밀번호가 일치하는지 검사한다.

### AccountNotFoundException

_BusinessException_

### AlreadyUseEmailException

_BusinessException_

### AlreadyUsePhoneException

_BusinessException_

### AlreadyVerifiedEmailException

_BusinessException_

### DisabledAccountException

_BusinessException_

### FailedSignInException

_BusinessException_

---

## 기기

### Device

_Entity_

_Aggregate Root_

#### 속성

- `store`: 기기가 등록된 매장
- `name`: 기기 이름
- `purpose`: `DevicePurpose` 기기 사용 용도
- `tableNo`: 테이블 번호
- `state`: 기기 상태
- `paymentType`: `DevicePaymentType` 기기 결제 타입
- `secretKey`: 기기 시크릿 키

#### 행위

- `static createPos()`: POS 기기를 생성한다.
- `static createHall()`: 홀 관리 기기를 생성한다.
- `static createTable()`: 손님 테이블 기기를 생성한다.
- `static createWaiting()`: 웨이팅 기기를 생성한다.
- `isActive()`: 기기가 활성 상태인지 여부를 반환한다.
- `isPrepaid()`: 기기의 결제 타입이 선결제인지 여부를 반환한다.
- `hasPurpose()`: 기기의 사용 용도가 일치하는지 여부를 반환한다.
- `updatePos()`: 기기 정보 수정과 동시에 POS 기기로 변경한다.
- `updateHall()`: 기기 정보 수정과 동시에 홀 관리 기기로 변경한다.
- `updateTable()`: 기기 정보 수정과 동시에 손님 테이블 기기로 변경한다.
- `updateWaiting()`: 기기 정보 수정과 동시에 웨이팅 기기로 변경한다.
- `delete()`: 기기를 삭제한다.

### DeviceState

_Enum_

#### 상수

- `INACTIVE`: 비활성
- `ACTIVE`: 활성

### DevicePurpose

_Enum_

#### 상수

- `POS`: POS
- `HALL`: 홀 관리
- `TABLE`: 손님 테이블
- `WAITING`: 웨이팅

### DevicePaymentType

_Enum_

#### 상수

- `PREPAID`: 선결제 (손님 테이블에서 결제 후 주문)
- `POSTPAID`: 후결제 (손님 테이블에서 주문 후 POS에서 결제)

### DeviceNotFoundException

_BussinessException_

### AlreadyUseDeviceNameException

_BussinessException_

---
