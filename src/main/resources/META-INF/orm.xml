<?xml version="1.0" encoding="UTF-8"?>
<entity-mappings
  xmlns="http://www.hibernate.org/xsd/orm/mapping"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://www.hibernate.org/xsd/orm/mapping https://hibernate.org/xsd/orm/mapping/mapping-3.1.0.xsd"
>

  <access>FIELD</access>

  <entity class="com.everyonewaiter.domain.health.ApkVersion">
    <table name="apk_version"/>

    <attributes>
      <basic name="majorVersion">
        <column name="apk_major_version" nullable="false"/>
      </basic>
      <basic name="minorVersion">
        <column name="apk_minor_version" nullable="false"/>
      </basic>
      <basic name="patchVersion">
        <column name="apk_patch_version" nullable="false"/>
      </basic>
      <basic name="downloadUri">
        <column name="apk_download_uri" nullable="false" length="255"/>
      </basic>
    </attributes>
  </entity>

  <entity class="com.everyonewaiter.domain.contact.Contact">
    <table name="contact">
      <index
        name="idx_contact_store_name_license_phone_number"
        column-list="store_name, license, phone_number"
      />
      <index name="idx_contact_store_name_phone_number" column-list="store_name, phone_number"/>
      <index name="idx_contact_license_phone_number" column-list="license, phone_number"/>
      <index name="idx_contact_phone_number" column-list="phone_number"/>
    </table>

    <attributes>
      <basic name="storeName">
        <column name="store_name" nullable="false" length="30"/>
      </basic>
      <basic name="state">
        <column name="state" nullable="false"/>
        <enumerated>STRING</enumerated>
      </basic>
      <embedded name="license"/>
      <embedded name="phoneNumber"/>
    </attributes>
  </entity>

  <entity class="com.everyonewaiter.domain.auth.RefreshToken">
    <table name="refresh_token"/>

    <attributes>
      <basic name="accountId">
        <column name="account_id" nullable="false" updatable="false"/>
      </basic>
      <basic name="currentTokenId">
        <column name="current_token_id" nullable="false"/>
      </basic>
    </attributes>
  </entity>

  <entity class="com.everyonewaiter.domain.account.Account">
    <table name="account">
      <index name="idx_account_phone_number" column-list="phone_number"/>
      <index name="idx_account_email_permission_state" column-list="email, permission, state"/>
      <index name="idx_account_email_state" column-list="email, state"/>
      <index name="idx_account_permission_state" column-list="permission, state"/>
      <index name="idx_account_state" column-list="state"/>
    </table>

    <attributes>
      <basic name="password">
        <column name="password" nullable="false" length="60"/>
      </basic>
      <basic name="state">
        <column name="state" nullable="false"/>
        <enumerated>STRING</enumerated>
      </basic>
      <basic name="permission">
        <column name="permission" nullable="false"/>
        <enumerated>STRING</enumerated>
      </basic>
      <basic name="lastSignIn">
        <column name="last_sign_in" nullable="false"/>
      </basic>
      <embedded name="email"/>
      <embedded name="phoneNumber"/>
    </attributes>
  </entity>

  <entity class="com.everyonewaiter.domain.device.Device">
    <table name="device">
      <unique-constraint name="uk_device_store_id_name">
        <column-name>store_id</column-name>
        <column-name>name</column-name>
      </unique-constraint>
      <index name="idx_device_store_id_purpose_state" column-list="store_id, purpose, state"/>
    </table>

    <attributes>
      <basic name="name">
        <column name="name" nullable="false" length="20"/>
      </basic>
      <basic name="purpose">
        <column name="purpose" nullable="false"/>
        <enumerated>STRING</enumerated>
      </basic>
      <basic name="tableNo">
        <column name="table_no" nullable="false"/>
      </basic>
      <basic name="state">
        <column name="state" nullable="false"/>
        <enumerated>STRING</enumerated>
      </basic>
      <basic name="paymentType">
        <column name="payment_type" nullable="false"/>
        <enumerated>STRING</enumerated>
      </basic>
      <basic name="secretKey">
        <column name="secret_key" nullable="false" updatable="false" length="30"/>
      </basic>
      <many-to-one name="store" fetch="LAZY" optional="false">
        <join-column name="store_id" nullable="false"/>
      </many-to-one>
    </attributes>
  </entity>

  <entity class="com.everyonewaiter.domain.store.Registration">
    <table name="store_registration">
      <index
        name="idx_store_registration_account_id_name_status"
        column-list="account_id, name, status"
      />
      <index
        name="idx_store_registration_account_id_status_name"
        column-list="account_id, status, name"
      />
    </table>

    <attributes>
      <basic name="status">
        <column name="status" nullable="false"/>
        <enumerated>STRING</enumerated>
      </basic>
      <basic name="rejectReason">
        <column name="reject_reason" nullable="false" length="30"/>
      </basic>
      <many-to-one name="account" fetch="LAZY" optional="false">
        <join-column name="account_id" nullable="false" updatable="false"/>
      </many-to-one>
      <embedded name="detail"/>
    </attributes>
  </entity>

  <entity class="com.everyonewaiter.domain.store.Setting">
    <table name="store_setting"/>

    <attributes>
      <basic name="ksnetDeviceNo">
        <column name="ksnet_device_no" nullable="false" length="30"/>
      </basic>
      <basic name="extraTableCount">
        <column name="extra_table_count" nullable="false"/>
      </basic>
      <basic name="printerLocation">
        <column name="printer_location" nullable="false"/>
        <enumerated>STRING</enumerated>
      </basic>
      <basic name="showMenuPopup">
        <column name="show_menu_popup" nullable="false"/>
      </basic>
      <basic name="showOrderTotalPrice">
        <column name="show_order_total_price" nullable="false"/>
      </basic>
      <basic name="countryOfOrigins">
        <column name="country_of_origins" nullable="false" length="500"/>
        <convert
          converter="com.everyonewaiter.adapter.persistence.store.CountryOfOriginToListConverter"
        />
      </basic>
      <basic name="staffCallOptions">
        <column name="staff_call_options" nullable="false" length="255"/>
        <convert
          converter="com.everyonewaiter.adapter.persistence.store.StaffCallOptionToListConverter"
        />
      </basic>
    </attributes>
  </entity>

  <entity class="com.everyonewaiter.domain.store.Store">
    <table name="store"/>

    <attributes>
      <basic name="status">
        <column name="status" nullable="false"/>
        <enumerated>STRING</enumerated>
      </basic>
      <basic name="lastOpenedAt">
        <column name="last_opened_at" nullable="false"/>
      </basic>
      <basic name="lastClosedAt">
        <column name="last_closed_at" nullable="false"/>
      </basic>
      <many-to-one name="account" fetch="LAZY" optional="false">
        <join-column name="account_id" nullable="false" updatable="false"/>
      </many-to-one>
      <one-to-one name="setting" fetch="LAZY" optional="false">
        <join-column name="setting_id" nullable="false" updatable="false"/>
        <cascade>
          <cascade-all/>
        </cascade>
      </one-to-one>
      <embedded name="detail"/>
    </attributes>
  </entity>

  <entity class="com.everyonewaiter.domain.menu.Category">
    <table name="category">
      <unique-constraint name="uk_category_store_id_name">
        <column-name>store_id</column-name>
        <column-name>name</column-name>
      </unique-constraint>
    </table>

    <attributes>
      <basic name="name">
        <column name="name" nullable="false" length="20"/>
      </basic>
      <many-to-one name="store" fetch="LAZY" optional="false">
        <join-column name="store_id" nullable="false" updatable="false"/>
      </many-to-one>
      <one-to-many name="menus" mapped-by="category" fetch="LAZY">
        <order-by>position asc, id asc</order-by>
      </one-to-many>
      <embedded name="position"/>
    </attributes>
  </entity>

  <entity class="com.everyonewaiter.domain.menu.Menu">
    <table name="menu">
      <index name="idx_menu_store_id_position" column-list="store_id, position asc"/>
      <index name="idx_menu_category_id_store_id" column-list="category_id, store_id"/>
    </table>

    <attributes>
      <basic name="name">
        <column name="name" nullable="false" length="30"/>
      </basic>
      <basic name="description">
        <column name="description" nullable="false" length="100"/>
      </basic>
      <basic name="price">
        <column name="price" nullable="false"/>
      </basic>
      <basic name="spicy">
        <column name="spicy" nullable="false"/>
      </basic>
      <basic name="state">
        <column name="state" nullable="false"/>
        <enumerated>STRING</enumerated>
      </basic>
      <basic name="label">
        <column name="label" nullable="false"/>
        <enumerated>STRING</enumerated>
      </basic>
      <basic name="image">
        <column name="image" nullable="false" length="30"/>
      </basic>
      <basic name="printEnabled">
        <column name="print_enabled" nullable="false"/>
      </basic>
      <many-to-one name="store" fetch="LAZY" optional="false">
        <join-column name="store_id" nullable="false" updatable="false"/>
      </many-to-one>
      <many-to-one name="category" fetch="LAZY" optional="false">
        <join-column name="category_id" nullable="false"/>
        <foreign-key
          name="fk_menu_category_id"
          foreign-key-definition="ON DELETE CASCADE"
        />
      </many-to-one>
      <one-to-many name="menuOptionGroups" mapped-by="menu" fetch="LAZY" orphan-removal="true">
        <order-by>position asc, id asc</order-by>
        <cascade>
          <cascade-all/>
        </cascade>
      </one-to-many>
      <embedded name="position"/>
    </attributes>
  </entity>

  <entity class="com.everyonewaiter.domain.menu.MenuOptionGroup">
    <table name="menu_option_group"/>

    <attributes>
      <basic name="name">
        <column name="name" nullable="false" length="30"/>
      </basic>
      <basic name="type">
        <column name="type" nullable="false"/>
        <enumerated>STRING</enumerated>
      </basic>
      <basic name="printEnabled">
        <column name="print_enabled" nullable="false"/>
      </basic>
      <many-to-one name="menu" fetch="LAZY" optional="false">
        <join-column name="menu_id" nullable="false" updatable="false"/>
        <foreign-key
          name="fk_menu_option_group_menu_id"
          foreign-key-definition="ON DELETE CASCADE"
        />
      </many-to-one>
      <element-collection name="menuOptions">
        <order-by>position asc</order-by>
        <collection-table name="menu_option">
          <join-column name="menu_option_group_id"/>
          <foreign-key
            name="fk_menu_option_menu_option_group_id"
            foreign-key-definition="ON DELETE CASCADE"
          />
        </collection-table>
      </element-collection>
      <embedded name="position"/>
    </attributes>
  </entity>

  <entity class="com.everyonewaiter.domain.waiting.Waiting">
    <table name="waiting">
      <index name="idx_waiting_store_id_created_at" column-list="store_id, created_at desc"/>
      <index
        name="idx_waiting_store_id_state_created_at"
        column-list="store_id, state, created_at desc"
      />
      <index name="idx_waiting_store_id_access_key" column-list="store_id, access_key"/>
      <index name="idx_waiting_phone_number_state" column-list="phone_number, state"/>
    </table>

    <attributes>
      <basic name="adult">
        <column name="adult" nullable="false"/>
      </basic>
      <basic name="infant">
        <column name="infant" nullable="false"/>
      </basic>
      <basic name="number">
        <column name="number" nullable="false"/>
      </basic>
      <basic name="initWaitingTeamCount">
        <column name="init_waiting_team_count" nullable="false"/>
      </basic>
      <basic name="accessKey">
        <column name="access_key" nullable="false" updatable="false" length="30"/>
      </basic>
      <basic name="state">
        <column name="state" nullable="false"/>
        <enumerated>STRING</enumerated>
      </basic>
      <many-to-one name="store" fetch="LAZY" optional="false">
        <join-column name="store_id" nullable="false" updatable="false"/>
      </many-to-one>
      <embedded name="phoneNumber"/>
      <embedded name="customerCall"/>
    </attributes>
  </entity>

  <entity class="com.everyonewaiter.domain.staffcall.StaffCall">
    <table name="staff_call">
      <index
        name="idx_staff_call_store_id_state_created_at"
        column-list="store_id, state, created_at desc"
      />
    </table>

    <attributes>
      <basic name="tableNo">
        <column name="table_no" nullable="false"/>
      </basic>
      <basic name="name">
        <column name="name" nullable="false" length="20"/>
      </basic>
      <basic name="state">
        <column name="state" nullable="false"/>
        <enumerated>STRING</enumerated>
      </basic>
      <basic name="completeTime">
        <column name="complete_time" nullable="false"/>
      </basic>
      <many-to-one name="store" fetch="LAZY" optional="false">
        <join-column name="store_id" nullable="false" updatable="false"/>
      </many-to-one>
    </attributes>
  </entity>

  <entity class="com.everyonewaiter.domain.order.Order">
    <table name="orders">
      <index name="idx_orders_store_id_created_at" column-list="store_id, created_at desc"/>
    </table>

    <attributes>
      <basic name="category">
        <column name="category" nullable="false"/>
        <enumerated>STRING</enumerated>
      </basic>
      <basic name="type">
        <column name="type" nullable="false"/>
        <enumerated>STRING</enumerated>
      </basic>
      <basic name="state">
        <column name="state" nullable="false"/>
        <enumerated>STRING</enumerated>
      </basic>
      <basic name="price">
        <column name="price" nullable="false"/>
      </basic>
      <basic name="memo">
        <column name="memo" nullable="false" length="30"/>
      </basic>
      <many-to-one name="store" fetch="LAZY" optional="false">
        <join-column name="store_id" nullable="false" updatable="false"/>
      </many-to-one>
      <many-to-one name="posTableActivity" fetch="LAZY" optional="false">
        <join-column name="pos_table_activity_id" nullable="false"/>
      </many-to-one>
      <one-to-many name="orderMenus" mapped-by="order" fetch="LAZY" orphan-removal="true">
        <order-by>id asc</order-by>
        <cascade>
          <cascade-all/>
        </cascade>
      </one-to-many>
      <embedded name="serving"/>
    </attributes>
  </entity>

  <entity class="com.everyonewaiter.domain.order.OrderMenu">
    <table name="orders_menu"/>

    <attributes>
      <basic name="name">
        <column name="name" nullable="false" length="30"/>
      </basic>
      <basic name="price">
        <column name="price" nullable="false"/>
      </basic>
      <basic name="quantity">
        <column name="quantity" nullable="false"/>
      </basic>
      <basic name="printEnabled">
        <column name="print_enabled" nullable="false"/>
      </basic>
      <many-to-one name="order" fetch="LAZY" optional="false">
        <join-column name="orders_id" nullable="false" updatable="false"/>
        <foreign-key
          name="fk_orders_menu_orders_id"
          foreign-key-definition="ON DELETE CASCADE"
        />
      </many-to-one>
      <one-to-many
        name="orderOptionGroups"
        mapped-by="orderMenu"
        fetch="LAZY"
        orphan-removal="true"
      >
        <order-by>id asc</order-by>
        <cascade>
          <cascade-all/>
        </cascade>
      </one-to-many>
      <embedded name="serving"/>
    </attributes>
  </entity>

  <entity class="com.everyonewaiter.domain.order.OrderOptionGroup">
    <table name="orders_option_group"/>

    <attributes>
      <basic name="name">
        <column name="name" nullable="false" length="30"/>
      </basic>
      <basic name="printEnabled">
        <column name="print_enabled" nullable="false"/>
      </basic>
      <many-to-one name="orderMenu" fetch="LAZY" optional="false">
        <join-column name="orders_menu_id" nullable="false" updatable="false"/>
        <foreign-key
          name="fk_orders_option_group_orders_menu_id"
          foreign-key-definition="ON DELETE CASCADE"
        />
      </many-to-one>
      <element-collection name="orderOptions">
        <order-by>position asc</order-by>
        <collection-table name="orders_option">
          <join-column name="orders_option_group_id"/>
          <foreign-key
            name="fk_orders_option_orders_option_group_id"
            foreign-key-definition="ON DELETE CASCADE"
          />
        </collection-table>
      </element-collection>
    </attributes>
  </entity>

  <entity class="com.everyonewaiter.domain.order.OrderPayment">
    <table name="orders_payment">
      <index
        name="idx_orders_payment_store_id_created_at"
        column-list="store_id, created_at desc"
      />
    </table>

    <attributes>
      <basic name="method">
        <column name="method" nullable="false"/>
        <enumerated>STRING</enumerated>
      </basic>
      <basic name="state">
        <column name="state" nullable="false"/>
        <enumerated>STRING</enumerated>
      </basic>
      <basic name="amount">
        <column name="amount" nullable="false"/>
      </basic>
      <basic name="cancellable">
        <column name="cancellable" nullable="false"/>
      </basic>
      <basic name="approvalNo">
        <column name="approval_no" nullable="false" length="30"/>
      </basic>
      <basic name="installment">
        <column name="installment" nullable="false" length="10"/>
      </basic>
      <basic name="cardNo">
        <column name="card_no" nullable="false" length="30"/>
      </basic>
      <basic name="issuerName">
        <column name="issuer_name" nullable="false" length="30"/>
      </basic>
      <basic name="purchaseName">
        <column name="purchase_name" nullable="false" length="30"/>
      </basic>
      <basic name="merchantNo">
        <column name="merchant_no" nullable="false" length="30"/>
      </basic>
      <basic name="tradeTime">
        <column name="trade_time" nullable="false" length="20"/>
      </basic>
      <basic name="tradeUniqueNo">
        <column name="trade_unique_no" nullable="false" length="30"/>
      </basic>
      <basic name="vat">
        <column name="vat" nullable="false"/>
      </basic>
      <basic name="supplyAmount">
        <column name="supply_amount" nullable="false"/>
      </basic>
      <basic name="cashReceiptNo">
        <column name="cash_receipt_no" nullable="false" length="30"/>
      </basic>
      <basic name="cashReceiptType">
        <column name="cash_receipt_type" nullable="false"/>
        <enumerated>STRING</enumerated>
      </basic>
      <many-to-one name="store" fetch="LAZY" optional="false">
        <join-column name="store_id" nullable="false" updatable="false"/>
      </many-to-one>
      <many-to-one name="posTableActivity" fetch="LAZY" optional="false">
        <join-column name="pos_table_activity_id" nullable="false"/>
      </many-to-one>
    </attributes>
  </entity>

  <entity class="com.everyonewaiter.domain.pos.PosTable">
    <table name="pos_table">
      <index
        name="idx_pos_table_store_id_active_table_no"
        column-list="store_id, active, table_no"
      />
    </table>

    <attributes>
      <basic name="tableNo">
        <column name="table_no" nullable="false"/>
      </basic>
      <basic name="active">
        <column name="active" nullable="false"/>
      </basic>
      <many-to-one name="store" fetch="LAZY" optional="false">
        <join-column name="store_id" nullable="false" updatable="false"/>
      </many-to-one>
      <one-to-many name="activities" mapped-by="posTable" fetch="LAZY">
        <order-by>id desc</order-by>
      </one-to-many>
    </attributes>
  </entity>

  <entity class="com.everyonewaiter.domain.pos.PosTableActivity">
    <table name="pos_table_activity">
      <index
        name="idx_pos_table_activity_store_id_active_created_at"
        column-list="store_id, active, created_at desc"
      />
      <index
        name="idx_pos_table_activity_store_id_active_table_no"
        column-list="store_id, active, table_no"
      />
    </table>

    <attributes>
      <basic name="tableNo">
        <column name="table_no" nullable="false"/>
      </basic>
      <basic name="discount">
        <column name="discount" nullable="false"/>
      </basic>
      <basic name="active">
        <column name="active" nullable="false"/>
      </basic>
      <many-to-one name="store" fetch="LAZY" optional="false">
        <join-column name="store_id" nullable="false" updatable="false"/>
      </many-to-one>
      <many-to-one name="posTable" fetch="LAZY" optional="false">
        <join-column name="pos_table_id" nullable="false"/>
      </many-to-one>
      <one-to-many name="orders" mapped-by="posTableActivity" fetch="LAZY">
        <order-by>id asc</order-by>
      </one-to-many>
      <one-to-many name="payments" mapped-by="posTableActivity" fetch="LAZY">
        <order-by>id asc</order-by>
      </one-to-many>
    </attributes>
  </entity>

  <embeddable class="com.everyonewaiter.domain.shared.Email">
    <attributes>
      <basic name="address">
        <column name="email" nullable="false" length="150"/>
      </basic>
    </attributes>
  </embeddable>

  <embeddable class="com.everyonewaiter.domain.shared.BusinessLicense">
    <attributes>
      <basic name="value">
        <column name="license" nullable="false" length="12"/>
      </basic>
    </attributes>
  </embeddable>

  <embeddable class="com.everyonewaiter.domain.shared.PhoneNumber">
    <attributes>
      <basic name="value">
        <column name="phone_number" nullable="false" length="11"/>
      </basic>
    </attributes>
  </embeddable>

  <embeddable class="com.everyonewaiter.domain.shared.Position">
    <attributes>
      <basic name="value">
        <column name="position" nullable="false"/>
      </basic>
    </attributes>
  </embeddable>

  <embeddable class="com.everyonewaiter.domain.store.BusinessDetail">
    <attributes>
      <basic name="name">
        <column name="name" nullable="false" length="30"/>
      </basic>
      <basic name="ceoName">
        <column name="ceo_name" nullable="false" length="20"/>
      </basic>
      <basic name="address">
        <column name="address" nullable="false" length="50"/>
      </basic>
      <basic name="landline">
        <column name="landline" nullable="false" length="13"/>
      </basic>
      <basic name="licenseImage">
        <column name="license_image" nullable="false" length="33"/>
      </basic>
      <embedded name="license"/>
    </attributes>
  </embeddable>

  <embeddable class="com.everyonewaiter.domain.menu.MenuOption">
    <attributes>
      <basic name="name">
        <column name="name" nullable="false" length="30"/>
      </basic>
      <basic name="price">
        <column name="price" nullable="false"/>
      </basic>
      <embedded name="position"/>
    </attributes>
  </embeddable>

  <embeddable class="com.everyonewaiter.domain.waiting.CustomerCall">
    <attributes>
      <basic name="count">
        <column name="call_count" nullable="false"/>
      </basic>
      <basic name="lastCallTime">
        <column name="last_call_time" nullable="false"/>
      </basic>
    </attributes>
  </embeddable>

  <embeddable class="com.everyonewaiter.domain.order.Serving">
    <attributes>
      <basic name="served">
        <column name="served" nullable="false"/>
      </basic>
      <basic name="servedTime">
        <column name="served_time" nullable="false"/>
      </basic>
    </attributes>
  </embeddable>

  <embeddable class="com.everyonewaiter.domain.order.OrderOption">
    <attributes>
      <basic name="name">
        <column name="name" nullable="false" length="30"/>
      </basic>
      <basic name="price">
        <column name="price" nullable="false"/>
      </basic>
      <embedded name="position"/>
    </attributes>
  </embeddable>

</entity-mappings>
